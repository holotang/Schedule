<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Schedule Pro</title>
    <style>
        :root { --main: #007bff; --high: #ff4d4d; --bg: #f4f7f9; --card: #ffffff; --text: #333; }
        body { font-family: "Helvetica Neue", Arial, sans-serif; background: var(--bg); margin: 0; padding-bottom: 100px; color: var(--text); }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        header { background: white; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        h1 { margin: 0; font-size: 1.2rem; color: var(--main); font-weight: 800; }

        /* åˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¤ãƒƒãƒ */
        .switch { background: #eee; border-radius: 12px; padding: 4px; display: flex; gap: 4px; }
        .switch button { border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.8rem; background: none; color: #777; transition: 0.3s; }
        .switch button.active { background: white; color: var(--main); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .container { max-width: 600px; margin: 0 auto; padding: 15px; }

        /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ« */
        .section-header { display: flex; align-items: center; gap: 8px; margin: 25px 0 15px 5px; color: var(--main); font-weight: bold; font-size: 1rem; }

        /* äºˆå®šã‚«ãƒ¼ãƒ‰ */
        .card { background: var(--card); border-radius: 16px; padding: 18px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border-left: 6px solid #ddd; position: relative; transition: 0.2s; }
        .card.prio-high { border-left-color: var(--high); }
        .card.today { border-left-color: var(--main); }
        .card:active { transform: scale(0.98); }

        .card-top { display: flex; justify-content: space-between; font-size: 0.75rem; color: #888; margin-bottom: 8px; }
        .card-cat { background: #f0f4ff; color: var(--main); padding: 2px 10px; border-radius: 20px; font-weight: bold; }
        .card-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 5px; display: block; }
        .card-date { font-size: 0.85rem; color: #666; }
        .card-del { position: absolute; right: 15px; bottom: 15px; background: #ffeded; color: #ff4d4d; border: none; padding: 6px 12px; border-radius: 8px; font-size: 0.7rem; font-weight: bold; cursor: pointer; }

        /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º */
        #calendar-view { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); display: none; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; text-align: center; }
        .cal-day-name { font-size: 0.7rem; color: #aaa; font-weight: bold; padding-bottom: 10px; }
        .cal-cell { aspect-ratio: 1; border-radius: 12px; background: #f9f9f9; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.9rem; position: relative; cursor: pointer; }
        .cal-cell.today { background: var(--main); color: white; font-weight: bold; }
        .cal-cell.has-item::after { content: ""; width: 5px; height: 5px; background: #ccc; border-radius: 50%; position: absolute; bottom: 5px; }
        .cal-cell.has-high::after { background: var(--high); width: 6px; height: 6px; }

        /* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ */
        .fab { position: fixed; bottom: 30px; right: 30px; width: 64px; height: 64px; background: var(--main); color: white; border: none; border-radius: 50%; font-size: 32px; box-shadow: 0 8px 20px rgba(0,123,255,0.3); z-index: 200; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 300; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        .modal-content { background: white; width: 85%; max-width: 400px; padding: 30px; border-radius: 28px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        .modal h2 { margin-top: 0; font-size: 1.3rem; color: var(--main); }
        input, select, textarea { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #eee; border-radius: 12px; background: #f9f9f9; font-size: 16px; box-sizing: border-box; }
        .save-btn { width: 100%; background: var(--main); color: white; border: none; padding: 16px; border-radius: 14px; font-weight: bold; font-size: 1rem; margin-top: 15px; box-shadow: 0 4px 10px rgba(0,123,255,0.2); }
    </style>
</head>
<body>

<header>
    <h1>ğŸ”¥ ã‚¹ãƒãƒ¼ãƒˆäºˆå®š</h1>
    <div class="switch">
        <button id="mode-list" class="active" onclick="setView('list')">ãƒªã‚¹ãƒˆ</button>
        <button id="mode-cal" onclick="setView('cal')">æœˆé–“</button>
    </div>
</header>

<div class="container">
    <div id="list-view">
        <div id="urgent-area"></div>
        <div id="today-area"></div>
        <div id="upcoming-area"></div>
    </div>

    <div id="calendar-view">
        <div style="text-align:center; font-weight:bold; margin-bottom:20px; font-size:1.1rem;" id="cal-title"></div>
        <div class="cal-grid" id="cal-grid"></div>
        <div id="day-detail" style="margin-top:25px; padding-top:15px; border-top:1px solid #eee;"></div>
    </div>
</div>

<button class="fab" onclick="openModal()">ï¼‹</button>

<div class="modal" id="modal">
    <div class="modal-content">
        <h2>æ–°è¦äºˆå®šã‚’è¿½åŠ </h2>
        <input type="date" id="in-date">
        <select id="in-cat">
            <option value="ğŸ¼ éŸ³æ¥½åˆ¶ä½œ">ğŸ¼ éŸ³æ¥½åˆ¶ä½œ</option>
            <option value="âš”ï¸ FF14">âš”ï¸ FF14</option>
            <option value="ğŸ‘¤ å€‹äºº">ğŸ‘¤ å€‹äºº</option>
        </select>
        <input type="text" id="in-title" placeholder="äºˆå®šã®ã‚¿ã‚¤ãƒˆãƒ«">
        <select id="in-prio">
            <option value="normal">é€šå¸¸</option>
            <option value="high">âš ï¸ æœ€å„ªå…ˆäº‹é …</option>
        </select>
        <textarea id="in-memo" placeholder="è©³ç´°ãƒ¡ãƒ¢..."></textarea>
        <button class="save-btn" onclick="save()">äºˆå®šã‚’ä¿å­˜</button>
        <button onclick="openModal()" style="width:100%; background:none; border:none; color:#aaa; margin-top:10px;">é–‰ã˜ã‚‹</button>
    </div>
</div>

<script>
    const STORAGE_KEY = 'schedule_v6';
    let currentView = 'list';

    function setView(v) {
        currentView = v;
        document.getElementById('list-view').style.display = v === 'list' ? 'block' : 'none';
        document.getElementById('calendar-view').style.display = v === 'cal' ? 'block' : 'none';
        document.getElementById('mode-list').classList.toggle('active', v === 'list');
        document.getElementById('mode-cal').classList.toggle('active', v === 'cal');
        if(v === 'cal') renderCalendar();
    }

    function openModal() {
        const m = document.getElementById('modal');
        m.style.display = m.style.display === 'flex' ? 'none' : 'flex';
    }

    function save() {
        const d = document.getElementById('in-date').value;
        const t = document.getElementById('in-title').value;
        if(!d || !t) return alert("æ—¥ä»˜ã¨ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥ã‚Œã¦ã­ï¼");
        
        const tasks = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        tasks.push({ d, t, cat: document.getElementById('in-cat').value, prio: document.getElementById('in-prio').value, memo: document.getElementById('in-memo').value, id: Date.now() });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
        
        openModal();
        renderList();
    }

    function renderList() {
        const tasks = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        tasks.sort((a,b) => new Date(a.d) - new Date(b.d));
        const today = new Date().toISOString().split('T')[0];

        const build = (items) => items.map(i => `
            <div class="card ${i.prio === 'high' ? 'prio-high' : ''} ${i.d === today ? 'today' : ''}">
                <div class="card-top"><span class="card-cat">${i.cat}</span> <span>${i.d}</span></div>
                <span class="card-title">${i.t}</span>
                ${i.memo ? `<div style="font-size:0.8rem; color:#888; margin-top:5px;">${i.memo}</div>` : ''}
                <button class="card-del" onclick="del(${i.id})">å‰Šé™¤</button>
            </div>
        `).join('');

        const urgent = tasks.filter(t => t.prio === 'high');
        const todList = tasks.filter(t => t.d === today && t.prio !== 'high');
        const upList = tasks.filter(t => t.d !== today && t.prio !== 'high');

        document.getElementById('urgent-area').innerHTML = urgent.length ? '<div class="section-header">ğŸ”¥ æœ€å„ªå…ˆäº‹é …</div>' + build(urgent) : '';
        document.getElementById('today-area').innerHTML = todList.length ? '<div class="section-header">ğŸ“… ä»Šæ—¥ã®äºˆå®š</div>' + build(todList) : '';
        document.getElementById('upcoming-area').innerHTML = '<div class="section-header">ğŸ’¡ ãã®ä»–ã®äºˆå®š</div>' + (upList.length ? build(upList) : '<p style="text-align:center;color:#ccc;">äºˆå®šãªã—</p>');
    }

    function renderCalendar() {
        const now = new Date();
        const y = now.getFullYear();
        const m = now.getMonth();
        document.getElementById('cal-title').innerText = `${y}å¹´ ${m + 1}æœˆ`;

        const first = new Date(y, m, 1).getDay();
        const last = new Date(y, m + 1, 0).getDate();
        const tasks = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

        let html = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'].map(d => `<div class="cal-day-name">${d}</div>`).join('');
        for(let i=0; i<first; i++) html += '<div></div>';
        
        for(let d=1; d<=last; d++) {
            const ds = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const dt = tasks.filter(t => t.d === ds);
            const high = dt.some(t => t.prio === 'high');
            html += `<div class="cal-cell ${ds === new Date().toISOString().split('T')[0] ? 'today' : ''} ${dt.length ? 'has-item' : ''} ${high ? 'has-high' : ''}" onclick="showDay('${ds}')">${d}</div>`;
        }
        document.getElementById('cal-grid').innerHTML = html;
    }

    function showDay(ds) {
        const dt = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]').filter(t => t.d === ds);
        document.getElementById('day-detail').innerHTML = `<div style="font-weight:bold; margin-bottom:10px;">ğŸ“ ${ds} ã®äºˆå®š</div>` + (dt.length ? dt.map(i => `<div style="padding:10px; background:#fff; border-radius:10px; margin-bottom:5px; font-size:0.9rem;">${i.t}</div>`).join('') : 'äºˆå®šãªã—');
    }

    function del(id) {
        if(!confirm("æ¶ˆã—ã¡ã‚ƒã†ã‚ˆï¼Ÿ")) return;
        localStorage.setItem(STORAGE_KEY, JSON.stringify(JSON.parse(localStorage.getItem(STORAGE_KEY)).filter(t => t.id !== id)));
        renderList();
        if(currentView === 'cal') renderCalendar();
    }

    window.onload = renderList;
</script>
</body>
</html>
